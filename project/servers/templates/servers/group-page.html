{% extends 'base.html' %}

{% block content %}


<!-- Beginning of main body (everything but the sidebar) -->
<body class="flex min-h-screen bg-blue-600">
    <main class="flex-1 grid grid-cols-3 gap-10 overflow-hidden p-10 mr-20">
        <!-- First Scrollable Container -->
        <div class="bg-gray-200 overflow-y-auto rounded-lg h-[calc(100vh-5rem)]">
            <h2 class="text-2xl font-bold mt-5 mb-5 ml-6">Tasks & Chores</h2>
            <a hx-get="{% url 'servers:add_task' events.first.server.id %}" hx-target="#dialog" class="">
                <div class="bg-white p-4 rounded-lg shadow-md mt-4 mb-5 block hover:bg-blue-400 mx-5">
                    <p class="text-lg font-bold text-center">Add Task & Chore</p>
                </div>
            </a>            
            {% for t in tasks %}
            <a href="{% url 'posts:chore' t.id %}">
                <div class="bg-white p-4 rounded-lg shadow-md mt-6 mx-5 block hover:bg-blue-400">
                    <h3 class="text-xl font-bold">{{ t.post_name }}</h3>
                    <p class="text-gray-600">{{ t.description }}</p>
                    <div class="flex justify-between items-center mt-2">
                        <span class="text-sm text-gray-400">{{ t.assigned_date | date:"l F d, Y" }}</span>
                        <div class="flex space-x-2">
                            {% if t.assigner == request.user %}
                            <a class="px-3 py-1 text-sm rounded bg-blue-500 text-white hover:bg-blue-600"
                                href="{%url 'servers:edit_task' t.id %}" hx-get="{%url 'servers:edit_task' t.id %}"
                                hx-target="#dialog">Edit Task</a>
                            {% endif %}
                        </div>
                    </div>
                    <hr class="my-2 border-gray-300">
                    <ul class="text-sm text-gray-600">
                        <li>Assigner / Post Creator: {% if request.user == t.assigner %} You {% else %} {{t.post_creator }} {% endif %}
                        </li>
                        <li>People Assigned to this task: {% for p in t.assignee.all %}
                            {% if p == request.user %}You{% else %}{{ p.first_name }} {{ p.last_name }}{% endif %}{%if not forloop.last%},
                            {% endif %}{% empty %} none
                            {% endfor %}
                        </li>
                        <li>Due date: {{ t.due_date | date:"l F d, Y" }} </li>
                        <li>Completed: {% if t.completed %}Yes{% else %}No{% endif %}</li>
                    </ul>
                </div>
            </a>
            {% endfor %}
        </div>



        <!-- Second Scrollable Container -->
        <div class="bg-gray-200 overflow-y-auto rounded-lg h-[calc(100vh-5rem)]" style="scrollbar-width: thin; /* Firefox */ scrollbar-color: rgba(155, 155, 155, 0.5) rgba(0, 0, 0, 0.1);">
            <h2 class="text-2xl font-bold mt-5 mb-5 ml-6">Bills</h2>
            <a hx-get="{% url 'servers:add_bill' events.first.server.id %}" hx-target="#dialog" class="">
                <div class="bg-white p-4 rounded-lg shadow-md mt-4 mb-5 block hover:bg-blue-400 mx-5">
                    <p class="text-lg font-bold text-center">Add Bill</p>
                </div>
            </a>
            {% for b in bills %}
            <a href="{% url 'posts:bill' b.id %}">
                <div class="bg-white p-4 rounded-lg shadow-md mt-6 mx-5 block hover:bg-blue-400">
                    <h3 class="text-xl font-bold">{{ b.post_name }}</h3>
                    <p class="text-gray-600">{{ b.description }}</p>
                    <div class="flex justify-between items-center mt-2">
                        <span class="text-sm text-gray-400">{{ b.posted_date | date:"l F d, Y" }}</span>
                        <div class="flex space-x-2">
                            {% if b.bill_creator == request.user %}
                            <a class="px-3 py-1 text-sm rounded bg-blue-500 text-white hover:bg-blue-600"
                                href="{%url 'servers:edit_bill' b.id %}" hx-get="{%url 'servers:edit_bill' b.id %}"
                                hx-target="#dialog">Edit Bill</a>
                            {% endif %}
                        </div>
                    </div>
                    <hr class="my-2 border-gray-300">
                    <ul class="text-sm text-gray-600">
                        <li>Creator: {% if request.user == b.bill_creator %} You {% else %} {{ b.post_creator }} {% endif %}</li>
                        <li>Cost: {{ b.cost }}</li>
                        <li>Payers:
                            {% for p in b.payers.all %}
                            {% if p == request.user %}You{% else %}{{ p.first_name }} {{ p.last_name }}{% endif %}{%if not forloop.last%},
                            {% endif %}{% empty %}none
                            {% endfor %}
                        </li>
                        <li>Payers (display names): {{ b.payers_string }}</li>
                        {% if b.split %}
                        <li>Your split: {{ b.portion }}</li>
                        {% else %}
                        <li>Bill is not being split</li>
                        {% endif %}
                        {% if b.completed %}
                        <li>Paid: Yes</li>
                        {% else %}
                        <li>Paid: No</li>
                        {% endif %}
                    </ul>
                </div>
            </a>
            {% endfor %}
            
        </div>




        <!-- Third Scrollable Container -->
        <div class="grid grid-cols-1 gap-8 h-[calc(100vh-5rem)]">
            <!-- People Container -->
            <div class="bg-gray-200 overflow-y-auto rounded-lg h-[calc(100vh-5rem)*1/3]">
                <h2 class="text-2xl font-bold mt-5 mb-5 ml-6">People</h2>
                <a hx-get="{% url 'servers:invitation' server_id=server_id %}" hx-target="#dialog" class="">
                    <div class="bg-white p-4 rounded-lg shadow-md mt-4 mb-5 block hover:bg-blue-400 mx-5">
                        <p class="text-lg font-bold text-center">Invite to Group</p>
                    </div>
                </a>               
                {% for p in participation %}
                <div class="bg-white p-4 rounded-lg shadow-md mt-6 mx-5 block hover:bg-blue-400">
                    <div class="flex justify-between items-center">
                        <h3 class="text-xl font-bold">{{ p.display_name }}</h3>
                        {% if p.is_owner %}
                        <span class="text-sm font-bold text-gray-400">Owner</span>
                        {% endif %}
                    </div>
                    <p class="text-gray-600">Joined: {{ p.date_joined }}</p>
                </div>
                {% endfor %}
            </div>

            <!-- Events Container -->
            <div class="bg-gray-300 overflow-y-auto rounded-lg h-[calc(100vh-5rem)*2/3]">
                <h2 class="text-2xl font-bold mt-5 mb-5 ml-6">Events</h2>
                <a hx-get="{% url 'servers:add_event' events.first.server.id %}" hx-target="#dialog" class="">
                    <div class="bg-white p-4 rounded-lg shadow-md mt-4 mb-5 block hover:bg-blue-400 mx-5">
                        <p class="text-lg font-bold text-center">Add Event</p>
                    </div>
                </a>
                {% for e in events %}
                <a href="{% url 'posts:event' e.id %}">
                    <div class="bg-white p-4 rounded-lg shadow-md mt-6 mx-5 block hover:bg-blue-400">
                        <h3 class="text-xl font-bold">{{ e.post_name }}</h3>
                        <p class="text-gray-600">{{ e.description }}</p>
                        <div class="flex justify-between items-center mt-2">
                            <span class="text-sm text-gray-400">{{ e.date_created | date:"l F d, Y" }}</span>
                            <div class="flex space-x-2">
                                {% if e.creator == request.user %}
                                <a class="px-3 py-1 text-sm rounded bg-blue-500 text-white hover:bg-blue-600"
                                    href="{%url 'servers:edit_event' e.id %}" hx-get="{%url 'servers:edit_event' e.id %}"
                                    hx-target="#dialog">Edit Event</a>
                                {% endif %}
                            </div>
                        </div>
                        <hr class="my-2 border-gray-300">
                        <ul class="text-sm text-gray-600">
                            <li>When is it: {{ e.date_time | date:"l F d, Y, h:i A" }}</li>
                            <li>Original poster: {% if request.user == e.creator %} You {% else %} {{ e.post_creator }} {% endif %}</li>
                        </ul>
                    </div>
                </a>
                {% endfor %}
                
            </div>
        </div>
        
        <div id="modal" class="modal fade">
            <div id="dialog" class="modal-dialog" hx-target="this"></div>
        </div>
        
    </main>
    
</body>

{% endblock %}